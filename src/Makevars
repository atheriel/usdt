PKG_CPPFLAGS = -Ivendor/libstapsdt/src -Ivendor/libusdt

all: $(SHLIB)
$(SHLIB): vendor

UNAME := $(shell uname -s)
ifeq ($(UNAME),Linux)
PKG_LIBS = -Lvendor/libstapsdt/out -lstapsdt -lelf -ldl

vendor:
	cd vendor/libstapsdt && $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS) $(CPICFLAGS)" AR="$(AR)" RANLIB="$(RANLIB)"

clean:
	cd vendor/libstapsdt && $(MAKE) clean
else
PKG_LIBS = -Lvendor/libusdt -lusdt

vendor:
	cd vendor/libusdt && $(MAKE) CC="$(CC)" CFLAGS="$(CFLAGS) $(CPICFLAGS)" AR="$(AR)" RANLIB="$(RANLIB)"

clean:
	cd vendor/libusdt && $(MAKE) clean
endif

.PHONY: all vendor clean
